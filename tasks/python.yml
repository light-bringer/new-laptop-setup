---
- name: Install and configure Python
  block:
    - name: Install Python tools via Homebrew
      community.general.homebrew:
        name: "{{ item }}"
        state: present
      loop:
        - python@3.12      # Python 3.12
        - pipx             # Isolated Python tool installation
        - virtualenv       # Virtual environment creation

    - name: Ensure pipx path is configured
      ansible.builtin.shell: pipx ensurepath
      register: pipx_ensurepath
      changed_when: "'already in PATH' not in pipx_ensurepath.stderr"
      failed_when: false

    - name: Verify Python installation
      ansible.builtin.command: python3 --version
      register: python_version
      changed_when: false

    - name: Verify pip installation
      ansible.builtin.command: pip3 --version
      register: pip_version
      changed_when: false

    - name: Verify virtualenv installation
      ansible.builtin.command: virtualenv --version
      register: virtualenv_version
      changed_when: false

    - name: Display Python tools versions
      ansible.builtin.debug:
        msg:
          - "Python: {{ python_version.stdout }}"
          - "pip: {{ pip_version.stdout }}"
          - "virtualenv: {{ virtualenv_version.stdout }}"
